<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢ - ‡∏ú‡∏•‡∏™‡∏•‡∏≤‡∏Å‡∏Å‡∏¥‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏• (Fixed Database)</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Prompt', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 1rem; }
        
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; border-radius: 1rem; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        
        /* Header & Dropdown */
        .header { text-align: center; margin-bottom: 2rem; }
        .header h1 { font-size: 2rem; color: #667eea; margin-bottom: 1rem; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏ß‡∏î */
        .draw-selector {
            display: block;
            margin: 0 auto 1rem auto;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            font-size: 1.1rem;
            font-family: 'Prompt', sans-serif;
            font-weight: 600;
            cursor: pointer;
            outline: none;
            text-align: center;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.2em;
            padding-right: 3rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s;
            max-width: 350px;
            width: 100%;
        }
        .draw-selector:hover { box-shadow: 0 6px 12px rgba(102, 126, 234, 0.15); }
        .draw-selector:focus { border-color: #764ba2; }

        .status-badges { display: flex; gap: 0.5rem; justify-content: center; margin-top: 1rem; flex-wrap: wrap; }
        .badge { font-size: 0.75rem; font-weight: 600; padding: 0.25rem 0.75rem; border-radius: 50px; }
        .badge-live { background: #10b981; color: white; }
        .badge-offline { background: #ef4444; color: white; }
        .badge-source { background: #f3f4f6; color: #374151; }
        
        /* Prize Display */
        .prize-1 { background: linear-gradient(135deg, #fef3c7, #fde047); border-radius: 1rem; padding: 2rem; text-align: center; margin-bottom: 2rem; position: relative; overflow: hidden; }
        .prize-1::before { content: 'üéâ'; position: absolute; top: 10px; left: 20px; font-size: 2rem; opacity: 0.3; }
        .prize-1::after { content: 'üéä'; position: absolute; bottom: 10px; right: 20px; font-size: 2rem; opacity: 0.3; }
        .prize-1 .label { font-size: 1rem; color: #92400e; font-weight: 600; margin-bottom: 0.5rem; }
        .prize-1 .number { font-size: 3.5rem; font-weight: 700; color: #b91c1c; letter-spacing: 0.2em; font-family: 'Courier New', monospace; }
        .prize-1 .amount { font-size: 0.9rem; color: #92400e; margin-top: 0.5rem; }
        
        /* Small Prizes Grid */
        .small-prizes { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .prize-small { background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 0.75rem; padding: 1.5rem; text-align: center; transition: all 0.3s; }
        .prize-small:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .prize-small .label { font-size: 0.85rem; color: #6b7280; font-weight: 500; margin-bottom: 0.5rem; }
        .prize-small .number { font-size: 1.8rem; font-weight: 700; color: #667eea; font-family: 'Courier New', monospace; margin-bottom: 0.25rem; }
        .prize-small .amount { font-size: 0.75rem; color: #9ca3af; }
        
        /* Other Prizes */
        .prizes-section { margin-bottom: 2rem; }
        .prizes-section h3 { font-size: 1.1rem; color: #374151; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb; }
        .prize-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 0.75rem; max-height: 250px; overflow-y: auto; padding-right: 0.5rem; }
        .prize-item { background: white; border: 2px solid #e5e7eb; padding: 0.75rem; border-radius: 0.5rem; text-align: center; font-weight: 700; color: #1f2937; font-family: 'Courier New', monospace; font-size: 0.9rem; transition: all 0.2s; }
        .prize-item:hover { border-color: #667eea; background: #f5f3ff; }
        
        /* Check Section */
        .check-section { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .check-box { background: #f9fafb; border-radius: 1rem; padding: 1.5rem; }
        .check-box h3 { font-size: 1.2rem; color: #374151; margin-bottom: 1rem; }
        textarea { width: 100%; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; font-size: 1rem; font-family: 'Prompt', sans-serif; resize: vertical; min-height: 150px; }
        textarea:focus { outline: none; border-color: #667eea; }
        .btn { width: 100%; padding: 1rem; border: none; border-radius: 0.75rem; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: 'Prompt', sans-serif; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; margin-top: 1rem; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: white; border: 2px solid #e5e7eb; color: #374151; }
        .btn-secondary:hover { border-color: #667eea; color: #667eea; }
        
        /* Stats */
        .stat-value { font-size: 2rem; font-weight: 700; color: #667eea; margin: 1rem 0; font-family: 'Courier New', monospace; }
        
        /* Loading */
        .loading { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 9999; }
        .loading.show { display: flex; }
        .loading-content { text-align: center; color: white; }
        .spinner { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Scrollbar */
        .prize-grid::-webkit-scrollbar { width: 8px; }
        .prize-grid::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .prize-grid::-webkit-scrollbar-thumb { background: #667eea; border-radius: 10px; }
        
        @media (max-width: 768px) {
            .check-section { grid-template-columns: 1fr; }
            .small-prizes { grid-template-columns: 1fr; }
            .prize-1 .number { font-size: 2.5rem; }
            .card { padding: 1.5rem; }
        }
        
        .hidden { display: none !important; }
        .refresh-btn { position: fixed; bottom: 2rem; right: 2rem; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.3); transition: all 0.3s; z-index: 100; }
        .refresh-btn:hover { transform: scale(1.1); }
        .refresh-btn svg { width: 30px; height: 30px; }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p id="loadingText" style="font-size: 1.2rem;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏ú‡∏•‡∏™‡∏•‡∏≤‡∏Å...</p>
        </div>
    </div>

    <button class="refresh-btn" onclick="initApp()" title="‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
    </button>

    <div class="container">
        <div class="card">
            <div class="header">
                <h1>üèÜ ‡∏ú‡∏•‡∏™‡∏•‡∏≤‡∏Å‡∏Å‡∏¥‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•</h1>
                
                <select id="drawSelector" class="draw-selector" onchange="selectDraw(this.value)">
                    <option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</option>
                </select>

                <div class="status-badges">
                    <span id="statusBadge" class="badge badge-offline">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
                    <span id="sourceBadge" class="badge badge-source hidden">‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: -</span>
                </div>
            </div>

            <div class="prize-1">
                <div class="label">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1</div>
                <div class="number" id="prize1">------</div>
                <div class="amount">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏•‡∏∞ 6,000,000 ‡∏ö‡∏≤‡∏ó</div>
            </div>

            <div class="small-prizes">
                <div class="prize-small">
                    <div class="label">‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏ï‡∏±‡∏ß</div>
                    <div class="number" id="prize3Front">---</div>
                    <div class="amount">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏•‡∏∞ 4,000 ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="prize-small">
                    <div class="label">‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 3 ‡∏ï‡∏±‡∏ß</div>
                    <div class="number" id="prize3Back">---</div>
                    <div class="amount">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏•‡∏∞ 4,000 ‡∏ö‡∏≤‡∏ó</div>
                </div>
                <div class="prize-small">
                    <div class="label">‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 2 ‡∏ï‡∏±‡∏ß</div>
                    <div class="number" id="prize2Back" style="color: #db2777;">--</div>
                    <div class="amount">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏•‡∏∞ 2,000 ‡∏ö‡∏≤‡∏ó</div>
                </div>
            </div>

            <div class="prizes-section">
                <h3>‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 2 (200,000 ‡∏ö‡∏≤‡∏ó)</h3>
                <div class="prize-grid" id="prize2"></div>
            </div>

            <div class="prizes-section">
                <h3>‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 3 (80,000 ‡∏ö‡∏≤‡∏ó)</h3>
                <div class="prize-grid" id="prize3"></div>
            </div>

            <div class="prizes-section">
                <h3>‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 4 (40,000 ‡∏ö‡∏≤‡∏ó)</h3>
                <div class="prize-grid" id="prize4"></div>
            </div>

            <div class="prizes-section">
                <h3>‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 5 (20,000 ‡∏ö‡∏≤‡∏ó)</h3>
                <div class="prize-grid" id="prize5"></div>
            </div>
        </div>

        <div class="card">
            <div class="check-section">
                <div class="check-box">
                    <h3>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h3>
                    <textarea id="lottoInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å&#10;‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà&#10;‡πÄ‡∏ä‡πà‡∏ô 174629 917408"
                              oninput="this.value = this.value.replace(/[^\d\s]/g, '');"
                              onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); checkLottery(); }"></textarea>
                    <button class="btn btn-primary" onclick="checkLottery()">‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>
                </div>

                <div class="check-box">
                    <h3>üé≤ ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç (‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏á‡∏ß‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)</h3>
                    <div style="text-align: center;">
                        <div style="margin-bottom: 1.5rem;">
                            <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem;">‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</div>
                            <div class="stat-value" id="num2">--</div>
                            <button class="btn btn-secondary" onclick="randomNumber(2)">‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem;">‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</div>
                            <div class="stat-value" id="num3">---</div>
                            <button class="btn btn-secondary" onclick="randomNumber(3)">‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const MAX_HISTORY = 6;
        let lotteryData = null;
        let lottoDatabase = [];
        let digitWeights = Array(10).fill().map((_, i) => ({ digit: i.toString(), weight: 1 }));

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏•‡∏Ç‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å
        const sortNumbers = (arr) => arr.sort((a, b) => parseInt(a) - parseInt(b));

        // ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        const baseP2 = sortNumbers(["374502","048036","889775","679914","602910"]);
        const baseP3 = sortNumbers(["428751","586374","216443","479569","236455","592665","167591","319246","145551","893288"]);
        const baseP4 = sortNumbers(["542764","993587","613010","609198","326375","266256","391432","600759","275320","208769","538731","963842","246525","651287","710588","242893","771134","048178","604778","808593","718890","242652","192972","241852","427968","866166","287292","328346","297562","839220","633827","655598","287243","282059","695755","247143","796321","630109","377600","407126","755949","249030","870519","804105","469942","423483","350883","004427","811271","736797"]);
        const baseP5 = sortNumbers(["635894","529898","015930","664084","841210","969437","271442","211832","260267","681109","867328","000575","028288","764459","892661","337975","958247","004032","380022","396449","539052","005170","544055","120536","251893","874265","817156","274462","476748","532159","752340","764377","891763","493820","379999","674634","296996","036929","426735","618658","768482","306934","307310","961591","268024","736785","454523","927213","591145","054754","001748","560604","237806","902162","264668","266525","090116","089447","835232","678358","983524","832668","222763","642707","651872","423344","688316","865332","378697","103304","312009","363371","383514","562923","260592","118346","069035","544162","225058","049786","649677","473151","845518","798378","054311","475522","299277","560970","103742","039168","472821","383649","537830","393701","632576","795361","632552","681325","634513","944716"]);

        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏±‡∏Å: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏ß‡∏î‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô
        function generateMockPrizes(baseArray, offset) {
            return sortNumbers(baseArray.map(num => {
                let n = parseInt(num) + offset;
                if (n > 999999) n -= 999999;
                return n.toString().padStart(6, '0');
            }));
        }

        const defaultHistory = [
            { date: "1 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2569", prize1: "174629", prize3Front: ["195","917"], prize3Back: ["041","408"], prize2Back: "48", prize2: baseP2, prize3: baseP3, prize4: baseP4, prize5: baseP5 },
            { date: "17 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2569", prize1: "384592", prize3Front: ["123","456"], prize3Back: ["789","012"], prize2Back: "15", prize2: generateMockPrizes(baseP2, 11111), prize3: generateMockPrizes(baseP3, 11111), prize4: generateMockPrizes(baseP4, 11111), prize5: generateMockPrizes(baseP5, 11111) },
            { date: "30 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2568", prize1: "915478", prize3Front: ["321","654"], prize3Back: ["987","210"], prize2Back: "89", prize2: generateMockPrizes(baseP2, 22222), prize3: generateMockPrizes(baseP3, 22222), prize4: generateMockPrizes(baseP4, 22222), prize5: generateMockPrizes(baseP5, 22222) },
            { date: "16 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2568", prize1: "258147", prize3Front: ["111","222"], prize3Back: ["333","444"], prize2Back: "00", prize2: generateMockPrizes(baseP2, 33333), prize3: generateMockPrizes(baseP3, 33333), prize4: generateMockPrizes(baseP4, 33333), prize5: generateMockPrizes(baseP5, 33333) },
            { date: "1 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2568",  prize1: "369258", prize3Front: ["555","666"], prize3Back: ["777","888"], prize2Back: "55", prize2: generateMockPrizes(baseP2, 44444), prize3: generateMockPrizes(baseP3, 44444), prize4: generateMockPrizes(baseP4, 44444), prize5: generateMockPrizes(baseP5, 44444) },
            { date: "16 ‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô 2568", prize1: "741852", prize3Front: ["999","000"], prize3Back: ["147","258"], prize2Back: "77", prize2: generateMockPrizes(baseP2, 55555), prize3: generateMockPrizes(baseP3, 55555), prize4: generateMockPrizes(baseP4, 55555), prize5: generateMockPrizes(baseP5, 55555) }
        ];

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        async function initApp() {
            // ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å LocalStorage (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            const savedData = localStorage.getItem('lottoDatabasePro');
            lottoDatabase = savedData ? JSON.parse(savedData) : defaultHistory;

            renderDropdown();
            selectDraw(lottoDatabase[0].date); // ‡πÅ‡∏™‡∏î‡∏á‡∏á‡∏ß‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ 0 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

            // ‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á‡∏™‡∏•‡∏≤‡∏Å
            await fetchLatestAndSync();
        }

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏á‡∏ß‡∏î‡πÉ‡∏´‡∏°‡πà
        async function fetchLatestAndSync() {
            const loading = document.getElementById('loading');
            loading.classList.add('show');

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000);
                const targetUrl = encodeURIComponent('https://www.glo.or.th/api/lottery/getLatestLottery');
                let rawData;

                try {
                    const res1 = await fetch(`https://api.allorigins.win/get?url=${targetUrl}&t=${Date.now()}`, { signal: controller.signal });
                    if (!res1.ok) throw new Error();
                    const json1 = await res1.json();
                    rawData = JSON.parse(json1.contents);
                } catch (e) {
                    const res2 = await fetch(`https://api.codetabs.com/v1/proxy?quest=${targetUrl}`, { signal: controller.signal });
                    rawData = await res2.json();
                }
                clearTimeout(timeoutId);

                const parsedData = parseGLOData(rawData);

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏á‡∏ß‡∏î‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (parsedData.date !== lottoDatabase[0].date) {
                    lottoDatabase.unshift(parsedData); 
                    if (lottoDatabase.length > MAX_HISTORY) lottoDatabase.length = MAX_HISTORY;
                    localStorage.setItem('lottoDatabasePro', JSON.stringify(lottoDatabase));
                    
                    renderDropdown();
                    selectDraw(parsedData.date); 
                    Swal.fire({ title: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏ß‡∏î‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß!', text: `‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${parsedData.date} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, icon: 'success', toast: true, position: 'top-end', showConfirmButton: false, timer: 3000 });
                }
                
                document.getElementById('statusBadge').className = 'badge badge-live';
                document.getElementById('statusBadge').textContent = 'üü¢ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                document.getElementById('sourceBadge').textContent = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å: GLO Official';
                document.getElementById('sourceBadge').classList.remove('hidden');

            } catch (error) {
                console.warn('Network issue, using offline DB:', error);
                document.getElementById('statusBadge').className = 'badge badge-offline';
                document.getElementById('statusBadge').textContent = 'üî¥ ‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå';
                document.getElementById('sourceBadge').classList.add('hidden');
            } finally {
                loading.classList.remove('show');
            }
        }

        // ‡πÅ‡∏Å‡∏∞‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å GLO
        function parseGLOData(apiData) {
            const d = apiData.response.data;
            return {
                date: apiData.response.date,
                prize1: d.first[0].number,
                prize2: sortNumbers(d.second.map(i => i.number)),
                prize3: sortNumbers(d.third.map(i => i.number)),
                prize4: sortNumbers(d.fourth.map(i => i.number)),
                prize5: sortNumbers(d.fifth.map(i => i.number)),
                prize3Front: sortNumbers(d.last3f.map(i => i.number)),
                prize3Back: sortNumbers(d.last3b.map(i => i.number)),
                prize2Back: d.last2[0].number
            };
        }

        // ‡∏ß‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Dropdown
        function renderDropdown() {
            const selector = document.getElementById('drawSelector');
            selector.innerHTML = '';
            lottoDatabase.forEach((draw, index) => {
                const label = index === 0 ? `üåü ‡∏á‡∏ß‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (${draw.date})` : `üìÖ ‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${draw.date}`;
                selector.add(new Option(label, draw.date));
            });
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏á‡∏ß‡∏î
        function selectDraw(dateString) {
            const data = lottoDatabase.find(d => d.date === dateString);
            if(data) displayData(data);
        }

        // ‡πÇ‡∏ä‡∏ß‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        function displayData(data) {
            document.getElementById('prize1').textContent = data.prize1;
            document.getElementById('prize3Front').textContent = data.prize3Front.join(', ');
            document.getElementById('prize3Back').textContent = data.prize3Back.join(', ');
            document.getElementById('prize2Back').textContent = data.prize2Back;

            const renderPrizes = (prizes) => prizes.map(n => `<div class="prize-item">${n}</div>`).join('');
            document.getElementById('prize2').innerHTML = renderPrizes(data.prize2);
            document.getElementById('prize3').innerHTML = renderPrizes(data.prize3);
            document.getElementById('prize4').innerHTML = renderPrizes(data.prize4);
            document.getElementById('prize5').innerHTML = renderPrizes(data.prize5);

            lotteryData = data; // ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢‡∏î‡∏∂‡∏á‡πÑ‡∏õ‡πÉ‡∏ä‡πâ

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç
            const freq = {};
            [data.prize1, ...data.prize2, ...data.prize3].forEach(num => {
                [...num].forEach(digit => freq[digit] = (freq[digit] || 0) + 1);
            });
            digitWeights = Array(10).fill().map((_, i) => ({
                digit: i.toString(),
                weight: freq[i.toString()] || 1
            }));
        }

        // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢
        function checkLottery() {
            if (!lotteryData) return;
            const input = document.getElementById('lottoInput').value;
            const numbers = [...new Set(input.match(/\b\d{6}\b/g))];
            
            if (!numbers || numbers.length === 0) {
                Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏•‡∏Ç', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }

            let totalWin = 0;
            let results = [];

            numbers.forEach(num => {
                let prizes = [];
                let amount = 0;

                if (num === lotteryData.prize1) { prizes.push('ü•á ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1'); amount += 6000000; }
                if (lotteryData.prize2.includes(num)) { prizes.push('ü•à ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 2'); amount += 200000; }
                if (lotteryData.prize3.includes(num)) { prizes.push('ü•â ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 3'); amount += 80000; }
                if (lotteryData.prize4.includes(num)) { prizes.push('‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 4'); amount += 40000; }
                if (lotteryData.prize5.includes(num)) { prizes.push('‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 5'); amount += 20000; }
                
                lotteryData.prize3Front.forEach(p => { if (num.startsWith(p)) { prizes.push('‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏ï‡∏±‡∏ß'); amount += 4000; } });
                lotteryData.prize3Back.forEach(p => { if (num.endsWith(p)) { prizes.push('‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 3 ‡∏ï‡∏±‡∏ß'); amount += 4000; } });
                if (num.endsWith(lotteryData.prize2Back)) { prizes.push('‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 2 ‡∏ï‡∏±‡∏ß'); amount += 2000; }

                if (amount > 0) {
                    results.push({ num, prizes: prizes.join(', '), amount });
                    totalWin += amount;
                }
            });

            let html = `<div style="margin-bottom: 1rem; font-size: 0.9rem; color: #6b7280;">‡∏ï‡∏£‡∏ß‡∏à‡∏á‡∏ß‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${lotteryData.date}</div>`;
            
            if (results.length > 0) {
                html += `<div style="font-size: 1.5rem; font-weight: 700; color: #10b981; margin-bottom: 1rem;">üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏ñ‡∏π‡∏Å‡∏£‡∏ß‡∏° ${totalWin.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>`;
                html += '<div style="text-align: left; background: #f9fafb; padding: 1rem; border-radius: 0.5rem; max-height: 300px; overflow-y: auto;">';
                results.forEach(r => {
                    html += `<div style="margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid #e5e7eb;">
                        <div style="font-weight: 700; font-size: 1.1rem; color: #1f2937; font-family: monospace;">${r.num}</div>
                        <div style="color: #6b7280; font-size: 0.9rem; margin-top: 0.25rem;">${r.prizes}</div>
                        <div style="color: #10b981; font-weight: 600; margin-top: 0.25rem;">üí∞ +${r.amount.toLocaleString()} ‡∏ø</div>
                    </div>`;
                });
                html += '</div>';
                Swal.fire({ html, icon: 'success', confirmButtonColor: '#667eea', width: '600px' });
            } else {
                html += '<div style="font-size: 1.2rem; color: #ef4444;">üò¢ ‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢ ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</div>';
                html += '<div style="margin-top: 0.5rem; font-size: 0.9rem; color: #6b7280;">‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏á‡∏ß‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö!</div>';
                Swal.fire({ html, icon: 'error', confirmButtonColor: '#667eea' });
            }
        }

        // ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç
        function randomNumber(digits) {
            let result = '';
            for (let i = 0; i < digits; i++) {
                const totalWeight = digitWeights.reduce((sum, w) => sum + w.weight, 0);
                let random = Math.random() * totalWeight;
                for (let w of digitWeights) {
                    random -= w.weight;
                    if (random <= 0) { result += w.digit; break; }
                }
            }
            document.getElementById(digits === 2 ? 'num2' : 'num3').textContent = result;
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
